using UnityEngine;
using UnityEditor;
using UnityEditor.SceneManagement;
using XRBubbleLibrary.Core;
using XRBubbleLibrary.Mathematics;

namespace XRBubbleLibrary.Setup.Editor
{
    /// <summary>\n    /// Demo scene setup utility for creating the first working XR bubble demo\n    /// Implements Day 3 committee objectives: working bubbles with wave mathematics\n    /// </summary>\n    public class DemoSceneSetup : EditorWindow\n    {\n        [MenuItem(\"XR Bubble Library/Create Demo Scene\")]\n        public static void ShowWindow()\n        {\n            GetWindow<DemoSceneSetup>(\"XR Bubble Demo Setup\");\n        }\n        \n        [MenuItem(\"XR Bubble Library/Quick Demo Setup\")]\n        public static void QuickSetup()\n        {\n            CreateDemoScene();\n        }\n        \n        void OnGUI()\n        {\n            GUILayout.Label(\"XR Bubble Demo Scene Setup\", EditorStyles.boldLabel);\n            GUILayout.Space(10);\n            \n            GUILayout.Label(\"This will create a demo scene with:\");\n            GUILayout.Label(\"• 5-10 SimpleBubbleTest components with wave mathematics\");\n            GUILayout.Label(\"• Proper lighting for Quest 3 optimization\");\n            GUILayout.Label(\"• Basic XR interaction setup\");\n            GUILayout.Label(\"• Performance monitoring components\");\n            \n            GUILayout.Space(20);\n            \n            if (GUILayout.Button(\"Create Demo Scene\", GUILayout.Height(40)))\n            {\n                CreateDemoScene();\n            }\n            \n            GUILayout.Space(10);\n            \n            if (GUILayout.Button(\"Add Bubbles to Current Scene\", GUILayout.Height(30)))\n            {\n                AddBubblesToCurrentScene();\n            }\n        }\n        \n        static void CreateDemoScene()\n        {\n            // Create new scene\n            var newScene = EditorSceneManager.NewScene(NewSceneSetup.DefaultGameObjects, NewSceneMode.Single);\n            \n            // Set up lighting for Quest 3 optimization\n            SetupOptimalLighting();\n            \n            // Create bubble test objects\n            CreateBubbleTestObjects();\n            \n            // Create performance monitor\n            CreatePerformanceMonitor();\n            \n            // Save scene\n            string scenePath = \"Assets/Scenes/XRBubbleDemoScene.unity\";\n            EditorSceneManager.SaveScene(newScene, scenePath);\n            \n            Debug.Log($\"Demo scene created at: {scenePath}\");\n            Debug.Log(\"Ready for Quest 3 deployment and testing!\");\n        }\n        \n        static void AddBubblesToCurrentScene()\n        {\n            CreateBubbleTestObjects();\n            Debug.Log(\"Added bubble test objects to current scene\");\n        }\n        \n        static void SetupOptimalLighting()\n        {\n            // Configure lighting for Quest 3 performance\n            RenderSettings.ambientMode = UnityEngine.Rendering.AmbientMode.Trilight;\n            RenderSettings.ambientSkyColor = new Color(0.212f, 0.227f, 0.259f, 1f);\n            RenderSettings.ambientEquatorColor = new Color(0.114f, 0.125f, 0.133f, 1f);\n            RenderSettings.ambientGroundColor = new Color(0.047f, 0.043f, 0.035f, 1f);\n            \n            // Ensure directional light exists and is optimized\n            var directionalLight = FindObjectOfType<Light>();\n            if (directionalLight == null)\n            {\n                var lightGO = new GameObject(\"Directional Light\");\n                directionalLight = lightGO.AddComponent<Light>();\n                directionalLight.type = LightType.Directional;\n                lightGO.transform.rotation = Quaternion.Euler(50f, -30f, 0f);\n            }\n            \n            // Optimize for mobile XR\n            directionalLight.shadows = LightShadows.Soft;\n            directionalLight.shadowStrength = 0.8f;\n            directionalLight.intensity = 1.0f;\n        }\n        \n        static void CreateBubbleTestObjects()\n        {\n            // Create bubble container\n            var bubbleContainer = new GameObject(\"Bubble Test Container\");\n            \n            // Create 7 bubbles in a circular pattern (optimal for first demo)\n            int bubbleCount = 7;\n            float radius = 3f;\n            \n            for (int i = 0; i < bubbleCount; i++)\n            {\n                float angle = (i / (float)bubbleCount) * 2f * Mathf.PI;\n                Vector3 position = new Vector3(\n                    Mathf.Cos(angle) * radius,\n                    1f + Mathf.Sin(i * 0.5f) * 0.5f, // Slight height variation\n                    Mathf.Sin(angle) * radius\n                );\n                \n                CreateSingleBubble(position, i, bubbleContainer.transform);\n            }\n            \n            Debug.Log($\"Created {bubbleCount} bubble test objects in circular pattern\");\n        }\n        \n        static void CreateSingleBubble(Vector3 position, int index, Transform parent)\n        {\n            // Create bubble GameObject\n            var bubbleGO = new GameObject($\"BubbleTest_{index + 1}\");\n            bubbleGO.transform.position = position;\n            bubbleGO.transform.parent = parent;\n            \n            // Add SimpleBubbleTest component\n            var bubbleTest = bubbleGO.AddComponent<SimpleBubbleTest>();\n            \n            // Configure wave parameters with slight variations for natural look\n            var waveParams = WaveParameters.Default;\n            waveParams.primaryFrequency = 0.25f + (index * 0.02f); // Slight frequency variation\n            waveParams.primaryAmplitude = 0.02f + (index * 0.001f); // Slight amplitude variation\n            waveParams.primaryPhase = index * 0.3f; // Phase offset for natural variation\n            \n            bubbleTest.waveParams = waveParams;\n            bubbleTest.enableBreathing = true;\n            \n            // Add MeshFilter and MeshRenderer\n            var meshFilter = bubbleGO.AddComponent<MeshFilter>();\n            meshFilter.mesh = CreateSphereMesh();\n            \n            var meshRenderer = bubbleGO.AddComponent<MeshRenderer>();\n            meshRenderer.material = CreateBubbleMaterial(index);\n            \n            // Add collider for interaction\n            var collider = bubbleGO.AddComponent<SphereCollider>();\n            collider.isTrigger = true;\n            collider.radius = 0.5f;\n            \n            // Add Rigidbody for physics (optional)\n            var rigidbody = bubbleGO.AddComponent<Rigidbody>();\n            rigidbody.useGravity = false;\n            rigidbody.drag = 2f;\n            rigidbody.angularDrag = 5f;\n            \n            Debug.Log($\"Created bubble {index + 1} at position {position}\");\n        }\n        \n        static Mesh CreateSphereMesh()\n        {\n            // Create a sphere mesh programmatically\n            var tempSphere = GameObject.CreatePrimitive(PrimitiveType.Sphere);\n            var mesh = tempSphere.GetComponent<MeshFilter>().sharedMesh;\n            DestroyImmediate(tempSphere);\n            return mesh;\n        }\n        \n        static Material CreateBubbleMaterial(int index)\n        {\n            // Create basic bubble material with color variation\n            var material = new Material(Shader.Find(\"Universal Render Pipeline/Lit\"));\n            \n            // Color palette: neon-pastel as specified in design\n            Color[] bubbleColors = {\n                new Color(1f, 0.4f, 0.8f, 0.8f),    // Pink\n                new Color(0.4f, 0.8f, 1f, 0.8f),    // Blue\n                new Color(0.8f, 0.4f, 1f, 0.8f),    // Purple\n                new Color(0.4f, 1f, 0.8f, 0.8f),    // Teal\n                new Color(1f, 0.8f, 0.4f, 0.8f),    // Orange\n                new Color(0.8f, 1f, 0.4f, 0.8f),    // Green\n                new Color(1f, 0.4f, 0.4f, 0.8f)     // Red\n            };\n            \n            material.color = bubbleColors[index % bubbleColors.Length];\n            \n            // Configure for transparency\n            material.SetFloat(\"_Surface\", 1); // Transparent\n            material.SetFloat(\"_Blend\", 0);   // Alpha blend\n            material.SetFloat(\"_AlphaClip\", 0);\n            material.SetFloat(\"_SrcBlend\", (float)UnityEngine.Rendering.BlendMode.SrcAlpha);\n            material.SetFloat(\"_DstBlend\", (float)UnityEngine.Rendering.BlendMode.OneMinusSrcAlpha);\n            material.SetFloat(\"_ZWrite\", 0);\n            material.DisableKeyword(\"_ALPHATEST_ON\");\n            material.EnableKeyword(\"_ALPHABLEND_ON\");\n            material.DisableKeyword(\"_ALPHAPREMULTIPLY_ON\");\n            material.renderQueue = (int)UnityEngine.Rendering.RenderQueue.Transparent;\n            \n            return material;\n        }\n        \n        static void CreatePerformanceMonitor()\n        {\n            var monitorGO = new GameObject(\"Performance Monitor\");\n            var monitor = monitorGO.AddComponent<PerformanceMonitor>();\n            \n            Debug.Log(\"Added performance monitor for Quest 3 testing\");\n        }\n    }\n    \n    /// <summary>\n    /// Simple performance monitor for Quest 3 testing\n    /// Tracks FPS and provides basic performance feedback\n    /// </summary>\n    public class PerformanceMonitor : MonoBehaviour\n    {\n        [Header(\"Performance Monitoring\")]\n        public bool showOnScreenStats = true;\n        public KeyCode toggleKey = KeyCode.P;\n        \n        private float fps;\n        private float frameTime;\n        private int frameCount;\n        private float timeAccumulator;\n        private GUIStyle guiStyle;\n        \n        void Start()\n        {\n            // Initialize GUI style\n            guiStyle = new GUIStyle();\n            guiStyle.fontSize = 24;\n            guiStyle.normal.textColor = Color.white;\n            \n            Debug.Log(\"Performance Monitor started - Press P to toggle display\");\n        }\n        \n        void Update()\n        {\n            // Calculate FPS\n            frameCount++;\n            timeAccumulator += Time.deltaTime;\n            \n            if (timeAccumulator >= 1f)\n            {\n                fps = frameCount / timeAccumulator;\n                frameTime = (timeAccumulator / frameCount) * 1000f;\n                \n                frameCount = 0;\n                timeAccumulator = 0f;\n                \n                // Log performance data\n                if (fps < 60f)\n                {\n                    Debug.LogWarning($\"Performance Warning: FPS = {fps:F1}, Frame Time = {frameTime:F1}ms\");\n                }\n            }\n            \n            // Toggle display\n            if (Input.GetKeyDown(toggleKey))\n            {\n                showOnScreenStats = !showOnScreenStats;\n            }\n        }\n        \n        void OnGUI()\n        {\n            if (!showOnScreenStats) return;\n            \n            // Display performance stats\n            string statsText = $\"FPS: {fps:F1}\\nFrame Time: {frameTime:F1}ms\";\n            \n            // Color code based on performance\n            if (fps >= 60f)\n                guiStyle.normal.textColor = Color.green;\n            else if (fps >= 45f)\n                guiStyle.normal.textColor = Color.yellow;\n            else\n                guiStyle.normal.textColor = Color.red;\n            \n            GUI.Label(new Rect(10, 10, 200, 100), statsText, guiStyle);\n            \n            // Quest 3 specific info\n            GUI.Label(new Rect(10, 100, 300, 50), \"Quest 3 Target: 60+ FPS\", guiStyle);\n        }\n    }\n}"