using UnityEngine;
using UnityEditor;
using System.IO;

namespace XRBubbleLibrary.Setup.Editor
{
    /// <summary>
    /// Emergency cleanup utility to remove duplicate Scripts folder
    /// Addresses compilation errors caused by duplicate assembly definitions
    /// </summary>
    public class ScriptsFolderCleanup : EditorWindow
    {
        [MenuItem(\"XR Bubble Library/Emergency Cleanup/Remove Scripts Folder\")]
        public static void ShowWindow()
        {
            GetWindow<ScriptsFolderCleanup>(\"Scripts Folder Cleanup\");
        }
        
        [MenuItem(\"XR Bubble Library/Emergency Cleanup/Quick Scripts Removal\")]
        public static void QuickRemoval()
        {
            if (EditorUtility.DisplayDialog(\"Remove Scripts Folder\", 
                \"This will remove the duplicate Scripts folder causing compilation errors.\\n\\n\" +\n                \"All content is safely archived in ProjectDocumentation/Archive/DuplicateScripts/\\n\\n\" +\n                \"This action is REQUIRED to fix compilation errors.\", \n                \"Remove Scripts Folder\", \"Cancel\"))\n            {\n                RemoveScriptsFolder();\n            }\n        }\n        \n        void OnGUI()\n        {\n            GUILayout.Label(\"Scripts Folder Emergency Cleanup\", EditorStyles.boldLabel);\n            GUILayout.Space(10);\n            \n            GUILayout.Label(\"CRITICAL ISSUE:\", EditorStyles.boldLabel);\n            GUILayout.Label(\"• Duplicate Scripts folder causing compilation errors\");\n            GUILayout.Label(\"• Burst compiler cannot resolve Scripts.Performance assembly\");\n            GUILayout.Label(\"• SimpleBubbleTest.cs cannot access Mathematics namespace\");\n            \n            GUILayout.Space(10);\n            \n            GUILayout.Label(\"SOLUTION:\", EditorStyles.boldLabel);\n            GUILayout.Label(\"• Remove duplicate Scripts folder completely\");\n            GUILayout.Label(\"• All content is safely archived\");\n            GUILayout.Label(\"• Main assemblies contain authoritative code\");\n            \n            GUILayout.Space(20);\n            \n            GUI.backgroundColor = Color.red;\n            if (GUILayout.Button(\"REMOVE SCRIPTS FOLDER\", GUILayout.Height(40)))\n            {\n                if (EditorUtility.DisplayDialog(\"Confirm Removal\", \n                    \"This will permanently remove the Scripts folder.\\n\\n\" +\n                    \"All content is archived in ProjectDocumentation/Archive/DuplicateScripts/\\n\\n\" +\n                    \"This is REQUIRED to fix compilation errors.\", \n                    \"Remove\", \"Cancel\"))\n                {\n                    RemoveScriptsFolder();\n                }\n            }\n            GUI.backgroundColor = Color.white;\n            \n            GUILayout.Space(10);\n            \n            if (GUILayout.Button(\"Validate Archive Exists\", GUILayout.Height(30)))\n            {\n                ValidateArchive();\n            }\n        }\n        \n        static void RemoveScriptsFolder()\n        {\n            string scriptsPath = \"Assets/XRBubbleLibrary/Scripts\";\n            \n            if (Directory.Exists(scriptsPath))\n            {\n                try\n                {\n                    // First, validate archive exists\n                    string archivePath = \"ProjectDocumentation/Archive/DuplicateScripts\";\n                    if (!Directory.Exists(archivePath))\n                    {\n                        EditorUtility.DisplayDialog(\"Error\", \"Archive not found! Cannot safely remove Scripts folder.\", \"OK\");\n                        return;\n                    }\n                    \n                    // Remove the Scripts folder\n                    FileUtil.DeleteFileOrDirectory(scriptsPath);\n                    FileUtil.DeleteFileOrDirectory(scriptsPath + \".meta\");\n                    \n                    // Refresh Unity\n                    AssetDatabase.Refresh();\n                    \n                    Debug.Log(\"✅ Scripts folder removed successfully!\");\n                    Debug.Log(\"✅ Archive preserved at: \" + archivePath);\n                    Debug.Log(\"✅ Compilation errors should now be resolved.\");\n                    \n                    EditorUtility.DisplayDialog(\"Success\", \n                        \"Scripts folder removed successfully!\\n\\n\" +\n                        \"• Archive preserved\\n\" +\n                        \"• Compilation should now work\\n\" +\n                        \"• Check Unity console for errors\", \"OK\");\n                }\n                catch (System.Exception e)\n                {\n                    Debug.LogError(\"Failed to remove Scripts folder: \" + e.Message);\n                    EditorUtility.DisplayDialog(\"Error\", \"Failed to remove Scripts folder: \" + e.Message, \"OK\");\n                }\n            }\n            else\n            {\n                Debug.Log(\"Scripts folder not found - may already be removed.\");\n                EditorUtility.DisplayDialog(\"Info\", \"Scripts folder not found - may already be removed.\", \"OK\");\n            }\n        }\n        \n        static void ValidateArchive()\n        {\n            string archivePath = \"ProjectDocumentation/Archive/DuplicateScripts\";\n            \n            if (Directory.Exists(archivePath))\n            {\n                var files = Directory.GetFiles(archivePath, \"*\", SearchOption.AllDirectories);\n                Debug.Log($\"✅ Archive exists with {files.Length} files preserved.\");\n                EditorUtility.DisplayDialog(\"Archive Validated\", \n                    $\"Archive exists and contains {files.Length} files.\\n\\n\" +\n                    \"All Scripts folder content is safely preserved.\", \"OK\");\n            }\n            else\n            {\n                Debug.LogError(\"❌ Archive not found! Do not remove Scripts folder.\");\n                EditorUtility.DisplayDialog(\"Archive Missing\", \n                    \"Archive not found!\\n\\n\" +\n                    \"Cannot safely remove Scripts folder without archive.\", \"OK\");\n            }\n        }\n    }\n}"